# Парсер сайта на PHP

Парсер данных с популярного аниме-сайта animevost.org.


### Описание

Скрипт подключается к сайту, определяет максимальное количество страниц в разделе жанры и пытается получить необходимые данные.
Все полученные данные сохранятся в каталоге **data** в виде текстовых файлов.

Каждый отдельный файл - это новая страница. Новая запись в файле начинается с новой строки. В качестве разделителя строк используется символ "**|**".

### Поля с данными
* Название аниме
* Год выхода
* Жанр
* Тип
* Кол-во серий
* Режиссёр
* Описание

В некоторых записях может отсутствовать поле "Режиссёр", скрипт умеет это определять и заполняет пустой строкой.

На момент написания скрипта он полностью работал.

# Дополнения в форк от 101Room для чайников в PHP

## Установка PHP, запуск сервера для отладки

Чтобы доработать и отладить скрипт на PHP нужен работающий Web-сервер. Можно воспользоваться встроенным в дистрибутив PHP сервером, который позволяет отладить скрипт локально, на вашей машине и без разворачивания настоящего (большого и страшного) Web-сервера.

### Установка PHP в Windows

Загрузить дистрибутив можно с данного ресурса [https://windows.php.net/download/](https://windows.php.net/download/). Раз использовать предполагается сервер встроенный, то можно выбрать любой вариант. В книге указывается, что лучше воспользоваться вариантом Non Thread Safe. Перед названием дистрибутива указано в какой версии Visual Studio он был скомпилирован (VS и какая-то цифра). [1, стр. 105]

Если вы ставили себе Visual Studio, то все необходимый пакет уже может быть доступен (зависит от того какие компоненты ставили). Если его нет, то нужно загрузить и установить необходимый пакет -- распространяемый компонент Microsoft Visual C++ для Visual Studio. На данный момент (9-дек-2020) указана VS16 (это номер версии Visual Studio 2019 [2]).

*Важно: нужны библиотеки от английского варианта Visual Studio, русский вариант не подойдёт.* [1, стр. 105]

Последние поддерживаемые версии Visual C++ для скачивания есть на данном ресурсе: [https://support.microsoft.com/ru-ru/help/2977003/the-latest-supported-visual-c-downloads](https://support.microsoft.com/ru-ru/help/2977003/the-latest-supported-visual-c-downloads).

Допустим, PHP загружен. Можно распаковать его куда-нибудь и запустить из командной строки, зайдя в данную директорию. Например, распаковать в `C:\php`, тогда для проверки работы в командной строке набрать

`cd C:\php`

а затем (это отобразит текущую версию PHP)

`php -v`

А чтобы дуростью не страдать, лучше добавить `C:\php` в переменную окружения `PATH`. Тогда можно будет вызывать php из любой папки, а не только `C:\php`. Как добавить написано тут: [https://docs.microsoft.com/ru-ru/previous-versions/office/developer/sharepoint-2010/ee537574(v=office.14)](https://docs.microsoft.com/ru-ru/previous-versions/office/developer/sharepoint-2010/ee537574(v=office.14)). [1, стр. 105]

### Установка PHP в Linux (Ubuntu)

Ставится как и все другие программы через терминал с помощью  `apt-get`

`$ sudo apt-get update`  
`$ sudo apt-get upgrade`

это мы обновили пакеты, а теперь сама установка:

`$ sudo apt-get install php7`

и проверяем работу командой отображения версии [1, стр. 109]

`$ php -v`

### Запуск встроенного сервера

Работаем в командной строке. Если нет прав админа, то

`php -S localhost:4000`

а если есть права админа или задействована команда `sudo`, то можно и так

`php -S localhost:80`

В первом случае в браузере переходим по адресу `http://localhost:4000/`, во втором по адресу `http://localhost/`. По умолчанию выполняется файл index.php. Если нужен другой, то название файла (или путь до него надо дописать в адресе).

Чтобы остановить сервер (и вообще что-либо в терминале) нажмите Ctrl + C. [1, стр. 109]

## CURL

Кто не работал ранее с `curl` получит при попытке запуска скрипта ошибку

`Fatal error: Uncaught Error: Call to undefined function curl_init() in `

в строке 96. Это происходит потому, что не подключено расширение CURL.

### CURL для Windows

Нужно проверить файл php.ini: раскоментировать (убрать ; перед строкой)

`extension=php_curl.dll`

Не знаете как найти `php.ini`? Загляните на этот ресурc [https://ru.hostings.info/schools/vse-o-fayle-phpini.html](https://ru.hostings.info/schools/vse-o-fayle-phpini.html). Вкратце это делается с помощью скрипта

`<?php`  
`phpinfo();`  
`?>`

В данном форке скрипт с таким содержанием есть файл `myphpinfo.php`.

Обратившись к нему через браузер увидите где он напротив `Loaded Configuration File"` или `Configuration File (php.ini) Path`.

Кроме этого, нужно скопировать библиотеки `ssleay32.dll` и `libeay32.dll` из каталога где расположен PHP в папку, прописанную в переменной окружения `PATH`, например в `C:\Windows\system32`. Однако, если папку где находится PHP уже добавили в `PATH`, это, видимо, не требуется. [1, стр. 740], [3]

### CURL для Ubuntu

Нужно установить расширение:

`$ sudo apt-get install php7-curl`

Использованные источники:
1. Дмитрий Котеров, Игорь Симдянов "PHP 7 в подлиннике"
2. [https://www.apachelounge.com/viewtopic.php?p=38034](https://www.apachelounge.com/viewtopic.php?p=38034)
3. [https://www.cyberforum.ru/php-network/thread656155-page2.html](https://www.cyberforum.ru/php-network/thread656155-page2.html)